[h: tokenID = json.get(macro.args,0)]
[h: tokenName = getName(tokenID)]
[h: tokenImg = getTokenImage("", tokenID)]
[h: xCoord = getTokenX(false, tokenID)]
[h: yCoord = getTokenY(false, tokenID)]
[h: tokenSize = getProperty("size",tokenID)]
[h: senseList = stringToList(getProperty("senses", tokenID),",")]
[h: visionList = json.append("[]","darkvision","low-light","greater darkvision")]
[h: segmentKillMacroProps = json.set("{}","label","Kill/Unkill Segment","playerEditable", 0, "command", "[h: ca.pf2e.Kill_Troop_Segment(currentToken())]","tooltip","Kill/Unkill This Segment")]
[h: val = json.set("{}", "tokenImage", tokenImg, "name", tokenName + " B","x",xCoord+2,"y",yCoord, "gmName", "Secondary Troop Segment")]
[h: newTokenA = createToken(val)]
[h: createMacro(segmentKillMacroProps, newTokenA)]
[h: setSize(tokenSize,newTokenA)]
[h: setHasSight(1, newTokenA)]
[h: val = json.set("{}", "tokenImage", tokenImg, "name", tokenName + " C","x",xCoord,"y",yCoord+2, "gmName", "Secondary Troop Segment")]
[h: newTokenB = createToken(val)]
[h: createMacro(segmentKillMacroProps, newTokenB)]
[h: setSize(tokenSize,newTokenB)]
[h: setHasSight(1, newTokenB)]
[h: val = json.set("{}", "tokenImage", tokenImg, "name", tokenName + " D","x",xCoord+2,"y",yCoord+2, "gmName", "Secondary Troop Segment")]
[h: newTokenC = createToken(val)]
[h: createMacro(segmentKillMacroProps, newTokenC)]
[h: setSize(tokenSize,newTokenC)]
[h: setHasSight(1, newTokenC)]
[h, foreach(sense, senseList), code:{
	[h, if(json.contains(visionList,sense)), code:{
		[h: setSightType(js.ca.pf2e.capitalise(sense),newTokenA)]
		[h: setSightType(js.ca.pf2e.capitalise(sense),newTokenB)]
		[h: setSightType(js.ca.pf2e.capitalise(sense),newTokenC)]
	};{}]
}]
[h: setGMName("Primary Troop Segment", tokenID)]